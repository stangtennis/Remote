<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Remote Control Dashboard - Enhanced Edition</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh; color: #e2e8f0;
        }
        .header {
            background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(10px);
            padding: 20px 0; box-shadow: 0 2px 20px rgba(0,0,0,0.3);
            border-bottom: 1px solid #334155;
        }
        .header-content {
            max-width: 1600px; margin: 0 auto; padding: 0 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .header h1 { color: #60a5fa; font-size: 2rem; font-weight: 700; }
        .status-indicator {
            display: flex; align-items: center; gap: 10px;
            background: rgba(34, 197, 94, 0.2); padding: 8px 16px;
            border-radius: 20px; border: 1px solid #22c55e;
        }
        .status-dot {
            width: 8px; height: 8px; background: #22c55e;
            border-radius: 50%; animation: pulse 2s infinite;
        }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        .main-content {
            max-width: 1600px; margin: 0 auto; padding: 30px 20px;
            display: grid; grid-template-columns: 350px 1fr; gap: 30px;
        }
        
        .sidebar {
            background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(10px);
            border-radius: 15px; padding: 20px; height: fit-content;
            border: 1px solid #334155;
        }
        .sidebar h2 { color: #60a5fa; margin-bottom: 20px; font-size: 1.3rem; }
        
        .device-list {
            display: flex; flex-direction: column; gap: 15px;
        }
        .device-card {
            background: rgba(51, 65, 85, 0.6); border-radius: 10px; padding: 15px;
            border: 1px solid #475569; cursor: pointer; transition: all 0.3s ease;
            position: relative;
        }
        .device-card:hover { background: rgba(51, 65, 85, 0.8); border-color: #60a5fa; }
        .device-card.active { border-color: #22c55e; background: rgba(34, 197, 94, 0.1); }
        
        .device-name { font-weight: 600; color: #e2e8f0; margin-bottom: 5px; }
        .device-info { font-size: 0.85rem; color: #94a3b8; }
        .device-status {
            position: absolute; top: 10px; right: 10px;
            width: 10px; height: 10px; border-radius: 50%;
            background: #22c55e; animation: pulse 2s infinite;
        }
        .device-capabilities {
            display: flex; gap: 5px; margin-top: 8px; flex-wrap: wrap;
        }
        .capability-tag {
            background: rgba(96, 165, 250, 0.2); color: #60a5fa;
            padding: 2px 6px; border-radius: 4px; font-size: 0.7rem;
            border: 1px solid rgba(96, 165, 250, 0.3);
        }
        
        .control-panel {
            background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(10px);
            border-radius: 15px; padding: 20px; border: 1px solid #334155;
            display: flex; flex-direction: column; gap: 20px;
        }
        
        .screen-viewer {
            background: #000; border-radius: 10px; aspect-ratio: 16/9;
            display: flex; align-items: center; justify-content: center;
            border: 2px solid #334155; position: relative; overflow: hidden;
        }
        .screen-placeholder {
            color: #64748b; font-size: 1.2rem; text-align: center;
        }
        .screen-image {
            width: 100%; height: 100%; object-fit: contain;
        }
        
        .control-buttons {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }
        .control-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white; border: none; padding: 12px 20px; border-radius: 8px;
            font-weight: 600; cursor: pointer; transition: all 0.3s ease;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .control-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4); }
        .control-btn:disabled { 
            background: #374151; color: #6b7280; cursor: not-allowed; 
            transform: none; box-shadow: none;
        }
        .control-btn.danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        .control-btn.danger:hover { box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4); }
        .control-btn.success {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
        }
        .control-btn.success:hover { box-shadow: 0 8px 25px rgba(34, 197, 94, 0.4); }
        
        .session-info {
            background: rgba(51, 65, 85, 0.6); border-radius: 10px; padding: 15px;
            border: 1px solid #475569;
        }
        .session-info h3 { color: #60a5fa; margin-bottom: 10px; }
        .session-details { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; }
        .session-detail { font-size: 0.9rem; }
        .session-detail strong { color: #e2e8f0; }
        
        .input-controls {
            background: rgba(51, 65, 85, 0.6); border-radius: 10px; padding: 15px;
            border: 1px solid #475569;
        }
        .input-controls h3 { color: #60a5fa; margin-bottom: 15px; }
        .input-row {
            display: flex; gap: 10px; margin-bottom: 10px; align-items: center;
        }
        .input-field {
            background: rgba(15, 23, 42, 0.8); border: 1px solid #475569;
            color: #e2e8f0; padding: 8px 12px; border-radius: 6px; flex: 1;
        }
        .input-btn {
            background: #374151; color: #e2e8f0; border: none;
            padding: 8px 16px; border-radius: 6px; cursor: pointer;
            transition: background 0.3s ease;
        }
        .input-btn:hover { background: #4b5563; }
        
        .log-panel {
            background: rgba(15, 23, 42, 0.9); border-radius: 10px; padding: 15px;
            border: 1px solid #334155; max-height: 200px; overflow-y: auto;
        }
        .log-panel h3 { color: #60a5fa; margin-bottom: 10px; }
        .log-entry {
            font-family: 'Courier New', monospace; font-size: 0.8rem;
            color: #94a3b8; margin-bottom: 5px; padding: 5px;
            border-left: 2px solid #374151; padding-left: 10px;
        }
        .log-entry.success { border-left-color: #22c55e; color: #86efac; }
        .log-entry.error { border-left-color: #ef4444; color: #fca5a5; }
        .log-entry.info { border-left-color: #60a5fa; color: #93c5fd; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>üéÆ Remote Control Dashboard</h1>
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span>System Online</span>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="sidebar">
            <h2>üì± Connected Devices</h2>
            <div class="device-list" id="deviceList">
                <div class="device-card" onclick="selectDevice('loading')">
                    <div class="device-name">üîÑ Loading devices...</div>
                    <div class="device-info">Connecting to Supabase...</div>
                </div>
            </div>
        </div>

        <div class="control-panel">
            <div class="screen-viewer" id="screenViewer">
                <div class="screen-placeholder">
                    üì∫ Select a device to start remote control<br>
                    <small>Screen will appear here when session is active</small>
                </div>
            </div>

            <div class="control-buttons">
                <button class="control-btn success" id="startSessionBtn" onclick="startRemoteSession()" disabled>
                    üéØ Start Session
                </button>
                <button class="control-btn danger" id="endSessionBtn" onclick="endRemoteSession()" disabled>
                    üõë End Session
                </button>
                <button class="control-btn" onclick="captureScreen()" disabled id="captureBtn">
                    üì∏ Capture Screen
                </button>
                <button class="control-btn" onclick="sendCtrlAltDel()" disabled id="ctrlAltDelBtn">
                    ‚å®Ô∏è Ctrl+Alt+Del
                </button>
                <button class="control-btn" onclick="openFileManager()" disabled id="fileManagerBtn">
                    üìÅ File Manager
                </button>
                <button class="control-btn" onclick="refreshConnection()" id="refreshBtn">
                    üîÑ Refresh
                </button>
            </div>

            <div class="session-info" id="sessionInfo" style="display: none;">
                <h3>üìä Active Session</h3>
                <div class="session-details">
                    <div class="session-detail"><strong>Device:</strong> <span id="sessionDevice">-</span></div>
                    <div class="session-detail"><strong>Started:</strong> <span id="sessionStart">-</span></div>
                    <div class="session-detail"><strong>Duration:</strong> <span id="sessionDuration">-</span></div>
                    <div class="session-detail"><strong>Status:</strong> <span id="sessionStatus">-</span></div>
                </div>
            </div>

            <div class="input-controls">
                <h3>üéÆ Remote Input</h3>
                <div class="input-row">
                    <input type="text" class="input-field" id="textInput" placeholder="Type text to send..." disabled>
                    <button class="input-btn" onclick="sendText()" id="sendTextBtn" disabled>Send Text</button>
                </div>
                <div class="input-row">
                    <input type="text" class="input-field" id="mouseX" placeholder="X" style="width: 80px;" disabled>
                    <input type="text" class="input-field" id="mouseY" placeholder="Y" style="width: 80px;" disabled>
                    <button class="input-btn" onclick="sendMouseClick()" id="mouseClickBtn" disabled>Click</button>
                    <button class="input-btn" onclick="sendRightClick()" id="rightClickBtn" disabled>Right Click</button>
                </div>
            </div>

            <div class="log-panel">
                <h3>üìã Activity Log</h3>
                <div id="logEntries">
                    <div class="log-entry info">[21:00:00] Dashboard initialized</div>
                    <div class="log-entry info">[21:00:01] Connecting to Supabase backend...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase configuration
        const supabaseUrl = 'https://ptrtibzwokjcjjxvjpin.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB0cnRpYnp3b2tqY2pqeHZqcGluIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0MzE1NzEsImV4cCI6MjA3MDAwNzU3MX0.DPNxkQul1-13tqJ89mqYJAx7NSJjabOP4q8c6KgOnWk';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Global state
        let selectedDevice = null;
        let activeSession = null;
        let realtimeChannel = null;
        let devices = [];
        let sessionId = null;
        let deviceId = null;

        // Initialize dashboard
        function initializeDashboard() {
            logMessage('Dashboard initialized', 'info');
            logMessage('Connecting to Supabase backend...', 'info');
            
            // Load devices
            loadDevices();
            
            // Start device monitoring
            startDeviceMonitoring();
            
            // Parse URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            deviceId = urlParams.get('deviceId');
            sessionId = urlParams.get('sessionId');
            
            if (deviceId && sessionId) {
                logMessage(`Auto-connecting to device ${deviceId}`, 'info');
                connectToDevice(deviceId, sessionId);
            }
        }

        // Load devices from Supabase
        async function loadDevices() {
            try {
                const { data, error } = await supabase
                    .from('devices')
                    .select('*')
                    .eq('status', 'online')
                    .order('last_seen', { ascending: false });

                if (error) throw error;

                devices = data || [];
                renderDeviceList();
                logMessage(`Loaded ${devices.length} online devices`, 'info');
            } catch (error) {
                logMessage(`Failed to load devices: ${error.message}`, 'error');
            }
        }

        // Render device list
        function renderDeviceList() {
            const deviceList = document.getElementById('deviceList');
            
            if (devices.length === 0) {
                deviceList.innerHTML = `
                    <div class="device-card">
                        <div class="device-name">üì± No devices online</div>
                        <div class="device-info">Start an agent to see devices here</div>
                    </div>
                `;
                return;
            }

            deviceList.innerHTML = devices.map(device => `
                <div class="device-card ${selectedDevice?.device_id === device.device_id ? 'active' : ''}" 
                     onclick="selectDevice('${device.device_id}')">
                    <div class="device-status"></div>
                    <div class="device-name">üíª ${device.device_name}</div>
                    <div class="device-info">
                        ${device.platform} ‚Ä¢ ${device.ip_address}<br>
                        ${Math.round(device.total_memory / (1024*1024*1024))}GB RAM ‚Ä¢ ${device.cpu_count} CPUs
                    </div>
                    <div class="device-capabilities">
                        ${device.capabilities?.screen_capture ? '<span class="capability-tag">üì∏ Screen</span>' : ''}
                        ${device.capabilities?.input_control ? '<span class="capability-tag">üéÆ Input</span>' : ''}
                        ${device.capabilities?.file_transfer ? '<span class="capability-tag">üìÅ Files</span>' : ''}
                    </div>
                </div>
            `).join('');
        }

        // Select device
        function selectDevice(deviceId) {
            if (deviceId === 'loading') return;
            
            selectedDevice = devices.find(d => d.device_id === deviceId);
            if (!selectedDevice) return;

            renderDeviceList();
            document.getElementById('startSessionBtn').disabled = false;
            logMessage(`Selected device: ${selectedDevice.device_name}`, 'info');
        }

        // Connect to device using Supabase Realtime
        async function connectToDevice(deviceId, sessionId = null) {
            try {
                // Find device in list
                const device = devices.find(d => d.id === deviceId);
                if (!device) {
                    logMessage(`Device ${deviceId} not found`, 'error');
                    return;
                }
                
                // Update selected device
                selectedDevice = device;
                updateSelectedDeviceUI();
                
                // Generate session ID if not provided
                if (!sessionId) {
                    sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substring(2, 9);
                }
                
                // Create Supabase Realtime channel for this device
                logMessage(`Connecting to device ${device.device_name} via Supabase Realtime...`, 'info');
                
                const channelName = `device-${deviceId}`;
                
                // Subscribe to device's response channel
                realtimeChannel = supabase
                    .channel(channelName)
                    .on('broadcast', { event: 'response' }, (payload) => {
                        logMessage(`Received response from device`, 'info');
                        handleMessage(payload.payload);
                    })
                    .subscribe((status) => {
                        logMessage(`Supabase Realtime channel status: ${status}`, 'info');
                        
                        if (status === 'SUBSCRIBED') {
                            // Create session
                            activeSession = {
                                id: sessionId,
                                deviceId: deviceId,
                                deviceName: device.device_name,
                                startTime: new Date(),
                                status: 'connecting'
                            };
                            
                            // Update UI
                            updateSessionInfo();
                            enableControls();
                            
                            // Send initial command
                            sendCommand({
                                type: 'start_session',
                                deviceId: deviceId,
                                sessionId: sessionId
                            });
                            
                            logMessage(`Session ${sessionId} created`, 'success');
                        }
                    });
                
                // Update device status in database
                await supabase
                    .from('remote_devices')
                    .update({ 
                        is_online: true,
                        last_seen: new Date().toISOString()
                    })
                    .eq('id', deviceId);
                
            } catch (error) {
                logMessage(`Failed to connect: ${error.message}`, 'error');
            }
        }

        // Handle message from device
        function handleMessage(message) {
            switch (message.type) {
                case 'screen_frame':
                    if (activeSession && message.sessionId === activeSession.id) {
                        updateScreenFrame(message.data);
                    }
                    break;
                case 'session_response':
                    handleSessionResponse(message);
                    break;
                case 'input_response':
                    logMessage(`Input response: ${message.message}`, message.success ? 'success' : 'error');
                    break;
                case 'pong':
                    // Handle ping response
                    break;
                default:
                    logMessage(`Unknown message type: ${message.type}`, 'info');
            }
        }

        // Update screen frame
        function updateScreenFrame(imageData) {
            const screenViewer = document.getElementById('screenViewer');
            
            // Create image if it doesn't exist
            let screenImage = screenViewer.querySelector('.screen-image');
            if (!screenImage) {
                screenImage = document.createElement('img');
                screenImage.className = 'screen-image';
                screenViewer.innerHTML = '';
                screenViewer.appendChild(screenImage);
                
                // Add click event listener for mouse control
                screenImage.addEventListener('click', (e) => {
                    if (!activeSession) return;
                    
                    const rect = screenImage.getBoundingClientRect();
                    const scaleX = screenImage.naturalWidth / rect.width;
                    const scaleY = screenImage.naturalHeight / rect.height;
                    
                    const x = Math.round((e.clientX - rect.left) * scaleX);
                    const y = Math.round((e.clientY - rect.top) * scaleY);
                    
                    sendCommand({
                        type: 'mouse_input',
                        x: x,
                        y: y,
                        button: 'left',
                        action: 'click'
                    });
                    
                    logMessage(`Mouse click at (${x}, ${y})`, 'info');
                });
            }
            
            // Update image source
            screenImage.src = imageData;
        }

        // Enable/disable control buttons
        function enableControlButtons(enabled) {
            const buttons = ['captureBtn', 'ctrlAltDelBtn', 'fileManagerBtn', 'sendTextBtn', 'mouseClickBtn', 'rightClickBtn'];
            const inputs = ['textInput', 'mouseX', 'mouseY'];
            
            function enableControls() {
                document.getElementById('textInput').disabled = false;
                document.getElementById('sendTextBtn').disabled = false;
                document.getElementById('mouseX').disabled = false;
                document.getElementById('mouseY').disabled = false;
                document.getElementById('mouseClickBtn').disabled = false;
                document.getElementById('rightClickBtn').disabled = false;
                document.getElementById('ctrlAltDelBtn').disabled = false;
                document.getElementById('captureBtn').disabled = false;
                document.getElementById('fileManagerBtn').disabled = false;
                document.getElementById('sessionInfo').style.display = 'block';
                logMessage('Remote control enabled', 'success');
            }
            
            function disableControls() {
                document.getElementById('textInput').disabled = true;
                document.getElementById('sendTextBtn').disabled = true;
                document.getElementById('mouseX').disabled = true;
                document.getElementById('mouseY').disabled = true;
                document.getElementById('mouseClickBtn').disabled = true;
                document.getElementById('rightClickBtn').disabled = true;
                document.getElementById('ctrlAltDelBtn').disabled = true;
                document.getElementById('captureBtn').disabled = true;
                document.getElementById('fileManagerBtn').disabled = true;
                logMessage('Remote control disabled', 'info');
            }
            
            if (enabled) {
                enableControls();
            } else {
                disableControls();
            }
        }

        // Start remote session
        function startRemoteSession() {
            if (!selectedDevice) return;

            const sessionId = 'session_' + Date.now();
            activeSession = {
                id: sessionId,
                deviceId: selectedDevice.device_id,
                deviceName: selectedDevice.device_name,
                startTime: new Date(),
                status: 'starting'
            };

            // Update UI
            document.getElementById('startSessionBtn').disabled = true;
            document.getElementById('endSessionBtn').disabled = false;
            enableControlButtons(true);
            showSessionInfo();
            
            logMessage(`Starting remote session with ${selectedDevice.device_name}`, 'info');
            
            // Connect to device
            connectToDevice(selectedDevice.device_id, sessionId);
        }

        // End remote session
        function endRemoteSession() {
            if (!activeSession) return;

            // Send end session command
            sendCommand({
                type: 'end_session',
                sessionId: activeSession.id
            });

            // Update UI
            document.getElementById('startSessionBtn').disabled = false;
            document.getElementById('endSessionBtn').disabled = true;
            enableControlButtons(false);
            hideSessionInfo();
            clearScreenViewer();

            logMessage(`Ended remote session with ${activeSession.deviceName}`, 'info');
            activeSession = null;
        }

        // Handle session response
        function handleSessionResponse(message) {
            if (message.success) {
                if (activeSession) {
                    activeSession.status = 'active';
                    updateSessionInfo();
                    logMessage('Remote session started successfully', 'success');
                }
            } else {
                logMessage(`Session error: ${message.message || 'Unknown error'}`, 'error');
                endRemoteSession();
            }
        }

        // Show/hide session info
        function showSessionInfo() {
            document.getElementById('sessionInfo').style.display = 'block';
            updateSessionInfo();
        }

        function hideSessionInfo() {
            document.getElementById('sessionInfo').style.display = 'none';
        }

        function updateSessionInfo() {
            if (!activeSession) return;
            
            document.getElementById('sessionDevice').textContent = activeSession.deviceName;
            document.getElementById('sessionStart').textContent = activeSession.startTime.toLocaleTimeString();
            document.getElementById('sessionStatus').textContent = activeSession.status;
            
            const duration = Math.floor((Date.now() - activeSession.startTime.getTime()) / 1000);
            document.getElementById('sessionDuration').textContent = `${duration}s`;
        }

        // Clear screen viewer
        function clearScreenViewer() {
            document.getElementById('screenViewer').innerHTML = `
                <div class="screen-placeholder">
                    üì∫ Select a device to start remote control<br>
                    <small>Screen will appear here when session is active</small>
                </div>
            `;
        }

        // Send command to device via Supabase Realtime
        async function sendCommand(command) {
            try {
                if (!activeSession || !realtimeChannel || !deviceId) {
                    logMessage('Cannot send command: No active session', 'error');
                    return;
                }
                
                // Add metadata to command
                const commandPayload = {
                    ...command,
                    sender: 'remote_control',
                    sessionId: sessionId,
                    timestamp: Date.now()
                };
                
                // Send command via Supabase Realtime broadcast
                await supabase
                    .channel(`device-${deviceId}`)
                    .send({
                        type: 'broadcast',
                        event: 'command',
                        payload: commandPayload
                    });
                    
                logMessage(`Command sent: ${command.type}`, 'info');
                return true;
            } catch (error) {
                logMessage(`Error sending command: ${error.message}`, 'error');
                return false;
            }
        }

        // Control functions
        function captureScreen() {
            if (!activeSession) return;
            sendCommand({
                type: 'capture_screen'
            });
            logMessage('Capturing screen...', 'info');
        }

        function sendCtrlAltDel() {
            if (!activeSession) return;
            sendCommand({
                type: 'keyboard_input',
                key: 'ctrl+alt+del',
                action: 'press'
            });
            logMessage('Sent Ctrl+Alt+Del', 'info');
        }

        function sendText() {
            const textInput = document.getElementById('textInput');
            if (!activeSession || !textInput.value) return;
            
            sendCommand({
                type: 'keyboard_input',
                key: textInput.value,
                action: 'type'
            });
            
            logMessage(`Sent text: ${textInput.value}`, 'info');
            textInput.value = '';
        }

        function sendMouseClick() {
            const x = document.getElementById('mouseX').value;
            const y = document.getElementById('mouseY').value;
            
            if (!activeSession || !x || !y) return;
            
            sendCommand({
                type: 'mouse_input',
                x: parseInt(x),
                y: parseInt(y),
                button: 'left',
                action: 'click'
            });
            
            logMessage(`Mouse click at (${x}, ${y})`, 'info');
        }

        function sendRightClick() {
            const x = document.getElementById('mouseX').value;
            const y = document.getElementById('mouseY').value;
            
            if (!activeSession || !x || !y) return;
            
            sendCommand({
                type: 'mouse_input',
                x: parseInt(x),
                y: parseInt(y),
                button: 'right',
                action: 'click'
            });
            
            logMessage(`Right click at (${x}, ${y})`, 'info');
        }

        function openFileManager() {
            logMessage('Opening file manager...', 'info');
        }

        function refreshConnection() {
            logMessage('Refreshing connection...', 'info');
            loadDevices();
        }

        // Start device monitoring
        function startDeviceMonitoring() {
            // Refresh device list every 30 seconds
            setInterval(loadDevices, 30000);
            
            // Update session duration every second
            setInterval(() => {
                if (activeSession) {
                    updateSessionInfo();
                }
            }, 1000);
        }

        // Log message
        function logMessage(message, type = 'info') {
            const logEntries = document.getElementById('logEntries');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${timestamp}] ${message}`;
            
            logEntries.appendChild(entry);
            logEntries.scrollTop = logEntries.scrollHeight;
            
            // Keep only last 50 entries
            while (logEntries.children.length > 50) {
                logEntries.removeChild(logEntries.firstChild);
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeDashboard);
    </script>
</body>
</html>
