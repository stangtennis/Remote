<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåç Direct Agent Generator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; padding: 20px;
        }
        .container {
            max-width: 1200px; margin: 0 auto; background: white;
            border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); padding: 30px;
        }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: #333; font-size: 2.5rem; margin-bottom: 10px; }
        .status {
            background: #d4edda; border: 2px solid #28a745; border-radius: 10px;
            padding: 20px; margin-bottom: 30px; text-align: center; color: #155724;
        }
        .agent-builder {
            background: #f8f9fa; border-radius: 15px; padding: 30px; margin-bottom: 30px;
        }
        .agent-builder h2 { color: #333; margin-bottom: 20px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #555; }
        .form-group select, .form-group input {
            width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;
        }
        .btn {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); color: white;
            border: none; padding: 15px 30px; border-radius: 10px; cursor: pointer;
            font-size: 16px; font-weight: 600; transition: all 0.3s ease;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(79, 70, 229, 0.3); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .result {
            margin-top: 20px; padding: 15px; border-radius: 8px; display: none;
        }
        .result.success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .result.error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .download-link {
            display: inline-block; margin-top: 10px; padding: 10px 20px;
            background: #28a745; color: white; text-decoration: none;
            border-radius: 5px; font-weight: 600;
        }
        .download-link:hover { background: #218838; }
        .code-block {
            background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 5px;
            padding: 15px; margin: 10px 0; font-family: 'Courier New', monospace;
            white-space: pre-wrap; overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåç Direct Agent Generator</h1>
            <p>Generate client agents directly without Edge Function dependency</p>
        </div>
        
        <div class="status">
            <h3>‚úÖ System Status: Direct Generation Mode</h3>
            <p>Bypassing authentication issues ‚Ä¢ Generating agents locally ‚Ä¢ Ready for testing</p>
        </div>
        
        <div class="agent-builder">
            <h2>üèóÔ∏è Direct Agent Builder</h2>
            <p>Generate a pre-configured client agent for your target platform:</p>
            
            <form id="agent-form" onsubmit="generateAgent(event)">
                <div class="form-group">
                    <label for="platform">Platform:</label>
                    <select id="platform" required>
                        <option value="windows">Windows (.bat)</option>
                        <option value="macos">macOS (.sh)</option>
                        <option value="linux">Linux (.sh)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="deviceName">Device Name:</label>
                    <input type="text" id="deviceName" placeholder="e.g., MyTestPC" required>
                </div>
                
                <div class="form-group">
                    <label for="orgId">Organization ID (optional):</label>
                    <input type="text" id="orgId" placeholder="default" value="default">
                </div>
                
                <button type="submit" class="btn" id="generateBtn">üöÄ Generate Agent</button>
            </form>
            
            <div id="result" class="result"></div>
        </div>
    </div>

    <script>
        console.log('üåç Direct Agent Generator loaded');
        
        function generateAgent(event) {
            event.preventDefault();
            
            const generateBtn = document.getElementById('generateBtn');
            const result = document.getElementById('result');
            const platform = document.getElementById('platform').value;
            const deviceName = document.getElementById('deviceName').value;
            const orgId = document.getElementById('orgId').value || 'default';
            
            generateBtn.disabled = true;
            generateBtn.textContent = '‚è≥ Generating...';
            result.style.display = 'none';
            
            try {
                console.log('üèóÔ∏è Generating agent:', { platform, deviceName, orgId });
                
                // Generate agent content directly
                let agentContent = '';
                let filename = '';
                
                if (platform === 'windows') {
                    filename = `RemoteDesktopAgent_${deviceName.replace(/[^a-zA-Z0-9]/g, '_')}.bat`;
                    agentContent = generateWindowsAgent(deviceName, orgId);
                } else {
                    filename = `RemoteDesktopAgent_${deviceName.replace(/[^a-zA-Z0-9]/g, '_')}.sh`;
                    agentContent = generateUnixAgent(deviceName, orgId, platform);
                }
                
                // Create download link
                const blob = new Blob([agentContent], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                
                result.className = 'result success';
                result.innerHTML = \`
                    <h4>‚úÖ Agent Generated Successfully!</h4>
                    <p>Your \${platform} agent has been generated and is ready for download.</p>
                    <a href="\${url}" download="\${filename}" class="download-link">
                        üì• Download \${filename}
                    </a>
                    <div class="code-block">\${agentContent}</div>
                \`;
                result.style.display = 'block';
                
                console.log('‚úÖ Agent generated successfully');
                
            } catch (error) {
                console.error('‚ùå Agent generation failed:', error);
                
                result.className = 'result error';
                result.innerHTML = \`
                    <h4>‚ùå Agent Generation Failed</h4>
                    <p>Error: \${error.message}</p>
                \`;
                result.style.display = 'block';
            }
            
            generateBtn.disabled = false;
            generateBtn.textContent = 'üöÄ Generate Agent';
        }
        
        function generateWindowsAgent(deviceName, orgId) {
            return \`@echo off
REM Remote Desktop Agent for Windows
REM Device: \${deviceName}
REM Organization: \${orgId}
REM Generated: \${new Date().toISOString()}

echo üåç Remote Desktop Agent Starting...
echo Device Name: \${deviceName}
echo Organization: \${orgId}

REM Check if Node.js is installed
node --version >nul 2>&1
if %errorlevel% neq 0 (
    echo ‚ùå Node.js is not installed. Please install Node.js first.
    echo Download from: https://nodejs.org/
    pause
    exit /b 1
)

REM Create agent directory
if not exist "RemoteDesktopAgent" mkdir RemoteDesktopAgent
cd RemoteDesktopAgent

REM Download agent files
echo üì• Downloading agent files...
curl -L -o package.json "https://raw.githubusercontent.com/stangtennis/remote-desktop/main/client/package.json"
curl -L -o agent.js "https://raw.githubusercontent.com/stangtennis/remote-desktop/main/client/agent-global.js"

REM Install dependencies
echo üì¶ Installing dependencies...
npm install

REM Configure agent
echo üîß Configuring agent...
echo const config = { > config.js
echo   deviceName: '\${deviceName}', >> config.js
echo   orgId: '\${orgId}', >> config.js
echo   supabaseUrl: 'https://ptrtibzwokjcjjxvjpin.supabase.co', >> config.js
echo   supabaseKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB0cnRpYnp3b2tqY2pqeHZqcGluIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzM1MTI0NTYsImV4cCI6MjA0OTA4ODQ1Nn0.OwJ04BrJ6gZZ57fSeT-q5Q_mSsVaNia' >> config.js
echo }; >> config.js
echo module.exports = config; >> config.js

REM Start agent
echo üöÄ Starting Remote Desktop Agent...
node agent.js

pause\`;
        }
        
        function generateUnixAgent(deviceName, orgId, platform) {
            return \`#!/bin/bash
# Remote Desktop Agent for \${platform}
# Device: \${deviceName}
# Organization: \${orgId}
# Generated: \${new Date().toISOString()}

echo "üåç Remote Desktop Agent Starting..."
echo "Device Name: \${deviceName}"
echo "Organization: \${orgId}"

# Check if Node.js is installed
if ! command -v node &> /dev/null; then
    echo "‚ùå Node.js is not installed. Please install Node.js first."
    echo "Visit: https://nodejs.org/"
    exit 1
fi

# Create agent directory
mkdir -p RemoteDesktopAgent
cd RemoteDesktopAgent

# Download agent files
echo "üì• Downloading agent files..."
curl -L -o package.json "https://raw.githubusercontent.com/stangtennis/remote-desktop/main/client/package.json"
curl -L -o agent.js "https://raw.githubusercontent.com/stangtennis/remote-desktop/main/client/agent-global.js"

# Install dependencies
echo "üì¶ Installing dependencies..."
npm install

# Configure agent
echo "üîß Configuring agent..."
cat > config.js << EOF
const config = {
  deviceName: '\${deviceName}',
  orgId: '\${orgId}',
  supabaseUrl: 'https://ptrtibzwokjcjjxvjpin.supabase.co',
  supabaseKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB0cnRpYnp3b2tqY2pqeHZqcGluIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzM1MTI0NTYsImV4cCI6MjA0OTA4ODQ1Nn0.OwJ04BrJ6gZZ57fSeT-q5Q_mSsVaNia'
};
module.exports = config;
EOF

# Start agent
echo "üöÄ Starting Remote Desktop Agent..."
node agent.js\`;
        }
    </script>
</body>
</html>
