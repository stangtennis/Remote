<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸš€ Supabase Setup Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .step {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }

        .step:hover {
            border-color: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(79, 70, 229, 0.1);
        }

        .step-number {
            background: #4f46e5;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .step h3 {
            color: #1e293b;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .step p {
            color: #64748b;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.5;
            overflow-x: auto;
            margin: 15px 0;
            position: relative;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4f46e5;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .copy-btn:hover {
            background: #3730a3;
        }

        .copy-btn.copied {
            background: #059669;
        }

        .btn {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin: 10px 10px 10px 0;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(79, 70, 229, 0.3);
        }

        .btn.secondary {
            background: #64748b;
        }

        .btn.secondary:hover {
            background: #475569;
        }

        .success {
            background: #dcfce7;
            border: 2px solid #16a34a;
            color: #15803d;
        }

        .warning {
            background: #fef3c7;
            border: 2px solid #d97706;
            color: #92400e;
        }

        .url-display {
            background: #eff6ff;
            border: 2px solid #3b82f6;
            color: #1d4ed8;
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 16px;
            margin: 15px 0;
            word-break: break-all;
        }

        .progress {
            background: #e5e7eb;
            height: 8px;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .content {
                padding: 20px;
            }
            
            .step {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸš€ Supabase Setup Assistant</h1>
            <p>Automated deployment for your Remote Desktop System</p>
            <div class="progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </div>

        <div class="content">
            <!-- Step 1: Database Schema -->
            <div class="step" id="step1">
                <div class="step-number">1</div>
                <h3>ðŸ“Š Apply Database Schema</h3>
                <p>First, we need to set up the database tables and enable realtime features.</p>
                
                <a href="https://supabase.com/dashboard/project/ptrtibzwokjcjjxvjpin/sql/new" target="_blank" class="btn">
                    ðŸ”— Open SQL Editor
                </a>
                
                <p style="margin-top: 20px;"><strong>Copy and paste this SQL:</strong></p>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyToClipboard('schema-sql')">Copy</button>
                    <pre id="schema-sql">-- Phase 1: Supabase Realtime Schema Updates
-- Enable realtime for existing tables and add presence tracking

-- Enable realtime for existing tables
ALTER PUBLICATION supabase_realtime ADD TABLE remote_devices;
ALTER PUBLICATION supabase_realtime ADD TABLE remote_sessions;
ALTER PUBLICATION supabase_realtime ADD TABLE connection_logs;
ALTER PUBLICATION supabase_realtime ADD TABLE device_permissions;

-- Add presence tracking table for global device status
CREATE TABLE IF NOT EXISTS device_presence (
    device_id TEXT PRIMARY KEY,
    status TEXT NOT NULL CHECK (status IN ('online', 'offline', 'busy', 'controlled')),
    last_seen TIMESTAMPTZ DEFAULT NOW(),
    connection_info JSONB DEFAULT '{}',
    metadata JSONB DEFAULT '{}',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Enable RLS for device presence
ALTER TABLE device_presence ENABLE ROW LEVEL SECURITY;

-- Create policies for device presence (allow all for now, will restrict later)
CREATE POLICY "Public access for device presence" ON device_presence
    FOR ALL USING (TRUE);

-- Add realtime channels table for managing communication channels
CREATE TABLE IF NOT EXISTS realtime_channels (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    channel_name TEXT NOT NULL,
    channel_type TEXT NOT NULL CHECK (channel_type IN ('device', 'session', 'control', 'stream')),
    device_id TEXT,
    session_id UUID,
    created_by UUID,
    metadata JSONB DEFAULT '{}',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    expires_at TIMESTAMPTZ,
    UNIQUE(channel_name)
);

-- Enable RLS for realtime channels
ALTER TABLE realtime_channels ENABLE ROW LEVEL SECURITY;

-- Create policies for realtime channels
CREATE POLICY "Users can manage their own channels" ON realtime_channels
    FOR ALL USING (TRUE); -- Simplified for now

-- Add indexes for performance
CREATE INDEX IF NOT EXISTS idx_device_presence_status ON device_presence(status);
CREATE INDEX IF NOT EXISTS idx_device_presence_last_seen ON device_presence(last_seen);
CREATE INDEX IF NOT EXISTS idx_realtime_channels_device ON realtime_channels(device_id);
CREATE INDEX IF NOT EXISTS idx_realtime_channels_session ON realtime_channels(session_id);
CREATE INDEX IF NOT EXISTS idx_realtime_channels_type ON realtime_channels(channel_type);

-- Enable realtime for new tables
ALTER PUBLICATION supabase_realtime ADD TABLE device_presence;
ALTER PUBLICATION supabase_realtime ADD TABLE realtime_channels;

-- Agent tracking schema
CREATE TABLE IF NOT EXISTS agent_generations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    platform TEXT NOT NULL CHECK (platform IN ('windows', 'macos', 'linux')),
    device_name TEXT NOT NULL,
    device_token TEXT NOT NULL,
    org_id TEXT DEFAULT 'default',
    generated_at TIMESTAMPTZ DEFAULT NOW(),
    generated_by UUID,
    download_count INTEGER DEFAULT 0,
    last_downloaded TIMESTAMPTZ,
    metadata JSONB DEFAULT '{}',
    status TEXT DEFAULT 'active' CHECK (status IN ('active', 'revoked', 'expired'))
);

-- Enable RLS for agent generations
ALTER TABLE agent_generations ENABLE ROW LEVEL SECURITY;

-- Create policies for agent generations
CREATE POLICY "Public access for agent generations" ON agent_generations
    FOR ALL USING (TRUE);

-- Add indexes for agent tracking
CREATE INDEX IF NOT EXISTS idx_agent_generations_platform ON agent_generations(platform);
CREATE INDEX IF NOT EXISTS idx_agent_generations_device_token ON agent_generations(device_token);
CREATE INDEX IF NOT EXISTS idx_agent_generations_status ON agent_generations(status);
CREATE INDEX IF NOT EXISTS idx_agent_generations_generated_at ON agent_generations(generated_at);

-- Enable realtime for agent tracking
ALTER PUBLICATION supabase_realtime ADD TABLE agent_generations;</pre>
                </div>
                
                <button class="btn secondary" onclick="markStepComplete(1)">âœ… Schema Applied</button>
            </div>

            <!-- Step 2: Edge Function -->
            <div class="step" id="step2">
                <div class="step-number">2</div>
                <h3>âš¡ Deploy Edge Function</h3>
                <p>Now we'll deploy the agent builder Edge Function that generates downloadable client agents.</p>
                
                <a href="https://supabase.com/dashboard/project/ptrtibzwokjcjjxvjpin/functions" target="_blank" class="btn">
                    ðŸ”— Open Edge Functions
                </a>
                
                <p style="margin-top: 20px;"><strong>Steps:</strong></p>
                <ol style="margin-left: 20px; color: #64748b; line-height: 1.8;">
                    <li>Click "Create a new function"</li>
                    <li>Name: <code>agent-builder</code></li>
                    <li>Copy and paste the TypeScript code below</li>
                    <li>Click "Deploy function"</li>
                </ol>
                
                <div class="code-block">
                    <button class="copy-btn" onclick="copyToClipboard('edge-function-code')">Copy</button>
                    <pre id="edge-function-code">// Supabase Edge Function: Agent Builder
// Generates downloadable, pre-configured client agents like MeshCentral

import { serve } from "https://deno.land/std@0.168.0/http/server.ts"
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

const corsHeaders = {
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',
}

interface AgentConfig {
  supabaseUrl: string
  supabaseKey: string
  deviceToken: string
  deviceName: string
  orgId: string
  serverName: string
  autoStart: boolean
  hideWindow: boolean
  platform: string
}

serve(async (req) => {
  // Handle CORS preflight requests
  if (req.method === 'OPTIONS') {
    return new Response('ok', { headers: corsHeaders })
  }

  try {
    const url = new URL(req.url)
    const platform = url.searchParams.get('platform') || 'windows'
    const deviceName = url.searchParams.get('deviceName') || 'Remote Device'
    const orgId = url.searchParams.get('orgId') || 'default'
    const autoStart = url.searchParams.get('autoStart') === 'true'
    const hideWindow = url.searchParams.get('hideWindow') !== 'false'

    // Validate platform
    const supportedPlatforms = ['windows', 'macos', 'linux']
    if (!supportedPlatforms.includes(platform)) {
      return new Response(
        JSON.stringify({ error: 'Unsupported platform' }),
        { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
      )
    }

    // Generate unique device token
    const deviceToken = generateSecureToken(32)
    
    // Create agent configuration
    const agentConfig: AgentConfig = {
      supabaseUrl: Deno.env.get('SUPABASE_URL') || 'https://ptrtibzwokjcjjxvjpin.supabase.co',
      supabaseKey: Deno.env.get('SUPABASE_ANON_KEY') || 'sb_publishable_OwJ04BrJ6gZZ57fSeT-q5Q_mSsVaNia',
      deviceToken,
      deviceName,
      orgId,
      serverName: 'Remote Desktop System',
      autoStart,
      hideWindow,
      platform
    }

    // Generate the agent executable
    const agentExecutable = await generateAgentExecutable(platform, agentConfig)
    
    // Log agent generation
    console.log(`Generated agent for platform: ${platform}, device: ${deviceName}`)

    // Return the executable file
    const filename = getFilename(platform, deviceName)
    return new Response(agentExecutable, {
      headers: {
        ...corsHeaders,
        'Content-Type': 'application/octet-stream',
        'Content-Disposition': `attachment; filename="${filename}"`,
        'Content-Length': agentExecutable.byteLength.toString()
      }
    })

  } catch (error) {
    console.error('Agent builder error:', error)
    return new Response(
      JSON.stringify({ error: 'Failed to generate agent', details: error.message }),
      { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
    )
  }
})

function generateSecureToken(length: number): string {
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'
  let result = ''
  const randomArray = new Uint8Array(length)
  crypto.getRandomValues(randomArray)
  
  for (let i = 0; i < length; i++) {
    result += chars[randomArray[i] % chars.length]
  }
  return result
}

async function generateAgentExecutable(platform: string, config: AgentConfig): Promise<Uint8Array> {
  const agentScript = createAgentScript(platform, config)
  
  switch (platform) {
    case 'windows':
      return createWindowsExecutable(agentScript, config)
    case 'macos':
      return createMacOSApp(agentScript, config)
    case 'linux':
      return createLinuxPackage(agentScript, config)
    default:
      throw new Error(`Unsupported platform: ${platform}`)
  }
}

function createAgentScript(platform: string, config: AgentConfig): string {
  return `
// Auto-generated Remote Desktop Agent
// Platform: ${platform}
// Generated: ${new Date().toISOString()}

const { app, BrowserWindow, Tray, Menu, ipcMain, dialog } = require('electron');
const path = require('path');
const os = require('os');
const { createClient } = require('@supabase/supabase-js');

// Embedded configuration (injected during build)
const AGENT_CONFIG = ${JSON.stringify(config, null, 2)};

class RemoteDesktopAgent {
    constructor() {
        this.deviceId = this.generateDeviceId();
        this.supabase = createClient(AGENT_CONFIG.supabaseUrl, AGENT_CONFIG.supabaseKey);
        this.isConnected = false;
        this.tray = null;
        
        console.log('ðŸš€ Remote Desktop Agent starting...');
        console.log('ðŸ“± Device ID:', this.deviceId);
        console.log('ðŸŒ Server:', AGENT_CONFIG.supabaseUrl);
    }

    async initialize() {
        try {
            // Create system tray
            this.createTray();
            
            // Connect to Supabase
            await this.connectToSupabase();
            
            // Register device
            await this.registerDevice();
            
            console.log('âœ… Agent initialized successfully');
            
        } catch (error) {
            console.error('âŒ Failed to initialize agent:', error);
            this.showErrorDialog('Initialization Failed', error.message);
        }
    }

    generateDeviceId() {
        return Math.floor(100000000 + Math.random() * 900000000).toString();
    }

    async connectToSupabase() {
        try {
            const { data, error } = await this.supabase
                .from('remote_devices')
                .select('count')
                .limit(1);
                
            if (error) throw error;
            
            this.isConnected = true;
            console.log('âœ… Connected to Supabase globally');
            
        } catch (error) {
            console.error('âŒ Supabase connection failed:', error);
            throw error;
        }
    }

    async registerDevice() {
        try {
            const deviceInfo = {
                device_id: this.deviceId,
                device_name: AGENT_CONFIG.deviceName || os.hostname(),
                operating_system: process.platform,
                status: 'online',
                last_seen: new Date().toISOString(),
                metadata: {
                    version: '1.0.0',
                    platform: '${platform}',
                    auto_generated: true,
                    org_id: AGENT_CONFIG.orgId,
                    device_token: AGENT_CONFIG.deviceToken
                }
            };

            const { error } = await this.supabase
                .from('remote_devices')
                .upsert(deviceInfo);

            if (error) throw error;

            console.log('âœ… Device registered globally');
            this.updateTrayTooltip('Online - Ready for remote control');
            
        } catch (error) {
            console.error('âŒ Device registration failed:', error);
            throw error;
        }
    }

    createTray() {
        try {
            const contextMenu = Menu.buildFromTemplate([
                {
                    label: \`Device ID: \${this.deviceId}\`,
                    enabled: false
                },
                {
                    label: 'Status: Connecting...',
                    enabled: false
                },
                { type: 'separator' },
                {
                    label: 'Copy Device ID',
                    click: () => {
                        require('electron').clipboard.writeText(this.deviceId);
                    }
                },
                {
                    label: 'Quit',
                    click: () => app.quit()
                }
            ]);
            
            // Create a minimal tray (would use proper icon in production)
            this.tray = new Tray(require('nativeimage').createEmpty());
            this.tray.setContextMenu(contextMenu);
            this.tray.setToolTip('Remote Desktop Agent - Connecting...');
            
        } catch (error) {
            console.error('âš ï¸ Failed to create tray icon:', error);
        }
    }

    updateTrayTooltip(status) {
        if (this.tray) {
            this.tray.setToolTip(\`Remote Desktop Agent - \${status}\`);
        }
    }

    showErrorDialog(title, message) {
        dialog.showErrorBox(title, message);
    }
}

// App initialization
app.whenReady().then(async () => {
    const agent = new RemoteDesktopAgent();
    await agent.initialize();
});

app.on('window-all-closed', () => {
    // Keep running in background
});
`;
}

function createWindowsExecutable(script: string, config: AgentConfig): Uint8Array {
  const batchScript = \`@echo off
echo Installing Remote Desktop Agent...
echo Device Name: \${config.deviceName}
echo.

REM Create temp directory
mkdir "%TEMP%\\\\RemoteDesktopAgent" 2>nul
cd /d "%TEMP%\\\\RemoteDesktopAgent"

REM Create the agent script
echo Creating agent...
(
echo \${script.replace(/\\n/g, '\\necho ')}
) > agent.js

REM Create package.json
(
echo {
echo   "name": "remote-desktop-agent",
echo   "version": "1.0.0",
echo   "main": "agent.js",
echo   "dependencies": {
echo     "electron": "^22.0.0",
echo     "@supabase/supabase-js": "^2.39.0"
echo   }
echo }
) > package.json

REM Install dependencies and run
echo Installing dependencies...
npm install --silent

echo Starting Remote Desktop Agent...
npm start

pause
\`;

  return new TextEncoder().encode(batchScript);
}

function createMacOSApp(script: string, config: AgentConfig): Uint8Array {
  const shellScript = \`#!/bin/bash
echo "Installing Remote Desktop Agent..."
echo "Device Name: \${config.deviceName}"
echo

# Create app directory
mkdir -p ~/Applications/RemoteDesktopAgent.app/Contents/MacOS
cd ~/Applications/RemoteDesktopAgent.app/Contents/MacOS

# Create the agent script
cat > agent.js << 'EOF'
\${script}
EOF

# Create package.json
cat > package.json << 'EOF'
{
  "name": "remote-desktop-agent",
  "version": "1.0.0",
  "main": "agent.js",
  "dependencies": {
    "electron": "^22.0.0",
    "@supabase/supabase-js": "^2.39.0"
  }
}
EOF

# Install dependencies
echo "Installing dependencies..."
npm install --silent

echo "Starting Remote Desktop Agent..."
npm start
\`;

  return new TextEncoder().encode(shellScript);
}

function createLinuxPackage(script: string, config: AgentConfig): Uint8Array {
  const shellScript = \`#!/bin/bash
echo "Installing Remote Desktop Agent..."
echo "Device Name: \${config.deviceName}"
echo

# Create app directory
mkdir -p ~/.local/share/RemoteDesktopAgent
cd ~/.local/share/RemoteDesktopAgent

# Create the agent script
cat > agent.js << 'EOF'
\${script}
EOF

# Create package.json
cat > package.json << 'EOF'
{
  "name": "remote-desktop-agent",
  "version": "1.0.0",
  "main": "agent.js",
  "dependencies": {
    "electron": "^22.0.0",
    "@supabase/supabase-js": "^2.39.0"
  }
}
EOF

# Install dependencies
echo "Installing dependencies..."
npm install --silent

echo "Starting Remote Desktop Agent..."
npm start
\`;

  return new TextEncoder().encode(shellScript);
}

function getFilename(platform: string, deviceName: string): string {
  const safeName = deviceName.replace(/[^a-zA-Z0-9]/g, '_');
  
  switch (platform) {
    case 'windows':
      return \`RemoteDesktopAgent_\${safeName}.bat\`;
    case 'macos':
      return \`RemoteDesktopAgent_\${safeName}.sh\`;
    case 'linux':
      return \`RemoteDesktopAgent_\${safeName}.sh\`;
    default:
      return \`RemoteDesktopAgent_\${safeName}.txt\`;
  }
}</pre>
                </div>
                
                <button class="btn secondary" onclick="markStepComplete(2)">âœ… Edge Function Deployed</button>
            </div>

            <!-- Step 3: Test -->
            <div class="step" id="step3">
                <div class="step-number">3</div>
                <h3>ðŸ§ª Test Your Setup</h3>
                <p>Let's test that everything is working correctly!</p>
                
                <div class="url-display">
                    Test URL: https://ptrtibzwokjcjjxvjpin.supabase.co/functions/v1/agent-builder?platform=windows&deviceName=TestPC
                </div>
                
                <a href="https://ptrtibzwokjcjjxvjpin.supabase.co/functions/v1/agent-builder?platform=windows&deviceName=TestPC" target="_blank" class="btn">
                    ðŸ§ª Test Agent Builder
                </a>
                
                <a href="http://127.0.0.1:13601/test-supabase.html" target="_blank" class="btn">
                    ðŸ“Š Open Test Dashboard
                </a>
                
                <button class="btn secondary" onclick="markStepComplete(3)">âœ… Tests Passed</button>
            </div>

            <!-- Step 4: Complete -->
            <div class="step success" id="step4" style="display: none;">
                <div class="step-number">âœ…</div>
                <h3>ðŸŽ‰ Setup Complete!</h3>
                <p>Your Supabase Remote Desktop System is now fully deployed and ready to use!</p>
                
                <div style="margin-top: 20px;">
                    <a href="http://127.0.0.1:13601" target="_blank" class="btn">
                        ðŸš€ Open Dashboard
                    </a>
                    <a href="http://127.0.0.1:13601/test-supabase.html" target="_blank" class="btn secondary">
                        ðŸ“Š Test Page
                    </a>
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: #f0f9ff; border-radius: 10px; border: 2px solid #0ea5e9;">
                    <h4 style="color: #0c4a6e; margin-bottom: 10px;">ðŸŽ¯ What You Can Do Now:</h4>
                    <ul style="color: #075985; line-height: 1.8;">
                        <li>Generate and download client agents for Windows, macOS, and Linux</li>
                        <li>Monitor device presence and connections in real-time</li>
                        <li>Manage remote desktop sessions globally</li>
                        <li>Track agent deployments and usage statistics</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        let completedSteps = 0;
        const totalSteps = 3;

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                const btn = element.parentElement.querySelector('.copy-btn');
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                btn.classList.add('copied');
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        function markStepComplete(stepNumber) {
            const step = document.getElementById(`step${stepNumber}`);
            step.classList.add('success');
            
            completedSteps++;
            updateProgress();
            
            if (completedSteps === totalSteps) {
                document.getElementById('step4').style.display = 'block';
                document.getElementById('step4').scrollIntoView({ behavior: 'smooth' });
            }
        }

        function updateProgress() {
            const progressBar = document.getElementById('progressBar');
            const percentage = (completedSteps / totalSteps) * 100;
            progressBar.style.width = percentage + '%';
        }

        // Initialize progress
        updateProgress();
    </script>
</body>
</html>
