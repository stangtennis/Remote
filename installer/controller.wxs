<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <Product Id="*" 
             Name="Remote Desktop Controller" 
             Language="1033" 
             Version="2.59.0.0" 
             Manufacturer="StangTennis" 
             UpgradeCode="A1B2C3D4-E5F6-7890-ABCD-EF1234567890">
        
        <Package InstallerVersion="200" 
                 Compressed="yes" 
                 InstallScope="perMachine"
                 Description="Remote Desktop Controller with H.264 support"
                 Comments="Installs Remote Desktop Controller and FFmpeg"/>
        
        <MajorUpgrade DowngradeErrorMessage="A newer version is already installed."/>
        <MediaTemplate EmbedCab="yes"/>
        
        <Feature Id="ProductFeature" Title="Remote Desktop Controller" Level="1">
            <ComponentGroupRef Id="ProductComponents"/>
            <ComponentGroupRef Id="ShortcutComponents"/>
        </Feature>
        
        <Icon Id="AppIcon" SourceFile="controller.exe"/>
        <Property Id="ARPPRODUCTICON" Value="AppIcon"/>
        <Property Id="ARPHELPLINK" Value="https://github.com/stangtennis/Remote"/>
        
        <UIRef Id="WixUI_InstallDir"/>
        <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER"/>
        <WixVariable Id="WixUILicenseRtf" Value="LICENSE.rtf"/>
    </Product>
    
    <Fragment>
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="ProgramFiles64Folder">
                <Directory Id="INSTALLFOLDER" Name="Remote Desktop Controller"/>
            </Directory>
            <Directory Id="ProgramMenuFolder">
                <Directory Id="ApplicationProgramsFolder" Name="Remote Desktop Controller"/>
            </Directory>
            <Directory Id="DesktopFolder" Name="Desktop"/>
        </Directory>
    </Fragment>
    
    <Fragment>
        <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
            <Component Id="ControllerExe" Guid="*">
                <File Id="controller.exe" Source="controller.exe" KeyPath="yes"/>
            </Component>
            <Component Id="FFmpegExe" Guid="*">
                <File Id="ffmpeg.exe" Source="ffmpeg.exe" KeyPath="yes"/>
            </Component>
        </ComponentGroup>
        
        <ComponentGroup Id="ShortcutComponents" Directory="ApplicationProgramsFolder">
            <Component Id="ApplicationShortcut" Guid="*">
                <Shortcut Id="ApplicationStartMenuShortcut"
                          Name="Remote Desktop Controller"
                          Description="Remote Desktop Controller"
                          Target="[INSTALLFOLDER]controller.exe"
                          WorkingDirectory="INSTALLFOLDER"/>
                <RemoveFolder Id="CleanUpShortCut" Directory="ApplicationProgramsFolder" On="uninstall"/>
                <RegistryValue Root="HKCU" Key="Software\RemoteDesktopController" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
            </Component>
            <Component Id="DesktopShortcut" Guid="*" Directory="DesktopFolder">
                <Shortcut Id="DesktopShortcut"
                          Name="Remote Desktop Controller"
                          Description="Remote Desktop Controller"
                          Target="[INSTALLFOLDER]controller.exe"
                          WorkingDirectory="INSTALLFOLDER"/>
                <RegistryValue Root="HKCU" Key="Software\RemoteDesktopController" Name="desktop" Type="integer" Value="1" KeyPath="yes"/>
            </Component>
        </ComponentGroup>
    </Fragment>
</Wix>
